(()=>{"use strict";console.log("Netflix Subtitle Downloader: Content script loaded");let e=[],t=null;function o(e){window.postMessage({type:"NETFLIX_SUBTITLES_REQUEST",...e},"*")}chrome.runtime.onMessage.addListener(function(l,n,a){if(console.log("Netflix Subtitle Downloader: Received message from popup:",l),"checkNetflixPage"===l.action){const e=function(){const e=['h1[data-uia="hero-title"]',"h1.title",".title",'[data-uia="hero-title"]',"h1"];for(const t of e){const e=document.querySelector(t);if(e&&e.textContent&&e.textContent.trim())return e.textContent.trim()}const t=window.location.href.match(/\/watch\/(\d+)/);return t?`Netflix Video (ID: ${t[1]})`:"Unknown Title"}();console.log("Netflix Subtitle Downloader: Netflix page detected:",e),a({success:!0,isNetflixEpisode:!0,title:e,url:window.location.href})}else"getSubtitles"===l.action?(console.log("Netflix Subtitle Downloader: Requesting subtitles from page script"),o({action:"GET_TRACKS"}),a({success:!0,tracks:e,movieId:t||void 0})):"downloadSubtitle"===l.action?(console.log("Netflix Subtitle Downloader: Requesting subtitle download:",l.trackId),o({action:"DOWNLOAD_SUBTITLE",data:{trackId:l.trackId}}),a({success:!0,message:"Download request sent"})):(console.log("Netflix Subtitle Downloader: Unknown message action:",l.action),a({success:!1,error:"Unknown action"}))}),window.addEventListener("message",function(o){if("NETFLIX_SUBTITLES"===o.data.type)switch(console.log("Netflix Subtitle Downloader: Received message from page script:",o.data),o.data.action){case"TRACKS_AVAILABLE":e=o.data.data.tracks||[],t=o.data.data.movieId,console.log("Netflix Subtitle Downloader: Available tracks updated:",e);break;case"NO_TRACKS":e=[],console.log("Netflix Subtitle Downloader: No tracks available");break;case"DOWNLOAD_SUCCESS":console.log("Netflix Subtitle Downloader: Download successful:",o.data.data.filename);break;case"DOWNLOAD_ERROR":console.error("Netflix Subtitle Downloader: Download error:",o.data.data.error)}}),console.log("Netflix Subtitle Downloader: Injecting page script immediately"),function(){console.log("Netflix Subtitle Downloader: Injecting page script immediately");const e=document.createElement("script");e.src=chrome.runtime.getURL("page-script.js"),e.onload=function(){console.log("Netflix Subtitle Downloader: Page script loaded successfully"),e.remove()},e.onerror=function(){console.error("Netflix Subtitle Downloader: Failed to load page script")},document.head.insertBefore(e,document.head.firstChild)}(),console.log("Netflix Subtitle Downloader: Content script ready and listening for messages")})();